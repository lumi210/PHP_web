import{h as T,s as V,y as j,D as N,n as P,aF as S,F,p as D}from"./vue-Cm_-Ome7.js";function Y(t){return t.replace(/-(\w)/g,function(e,n){return n?n.toUpperCase():""})}function $(t){return t.install=function(e){var n=t,r=n.name;e.component(r,t),e.component(Y("-"+r),t)},t}var M=function(){function t(){this.listeners={}}var e=t.prototype;return e.on=function(r,d){this.listeners[r]===void 0&&(this.listeners[r]={triggered:!1,requested:!1,cbs:[]}),this.listeners[r].triggered&&d(),this.listeners[r].cbs.push(d)},e.emit=function(r){this.listeners[r]&&(this.listeners[r].triggered=!0,this.listeners[r].cbs.forEach(function(d){return d()}))},t}();function q(t,e){var n,r=function(){for(var l=this,i=arguments.length,s=new Array(i),c=0;c<i;c++)s[c]=arguments[c];n&&clearTimeout(n),n=setTimeout(function(){t.apply(l,s)},e)};return r.cancel=function(){n!==void 0&&clearTimeout(n)},r}function x(t){return t.reduce(function(e,n){return e.then(n)},Promise.resolve())}function H(t){for(var e="abcdefghijklmnopqrstuvwxyz",n="",r=0;r<t;r++)n+=e.charAt(Math.floor(Math.random()*e.length));return n}const G=T({name:"vue-ueditor-wrap",props:{editorId:String,name:String,modelValue:{type:String,default:""},config:Object,mode:{type:String,default:"observer",validator:function(e){return["observer","listener"].indexOf(e)!==-1}},observerOptions:{type:Object,default:function(){return{attributes:!0,attributeFilter:["src","style","type","name"],characterData:!0,childList:!0,subtree:!0}}},observerDebounceTime:{type:Number,default:50,validator:function(e){return e>=20}},forceInit:Boolean,destroy:{type:Boolean,default:!0},editorDependencies:{type:Array},editorDependenciesChecker:{type:Function}},emits:["update:modelValue","before-init","ready"],setup:function(e,n){var r=n.emit,d={UN_READY:"UN_READY",PENDING:"PENDING",READY:"READY"},l=d.UN_READY,i,s,c,E=V(),y=["ueditor.config.js","ueditor.all.min.js"],C=function(){return window.UE&&window.UE.getEditor&&window.UEDITOR_CONFIG&&Object.keys(window.UEDITOR_CONFIG).length!==0},p=j(e,"modelValue");window.$loadEventBus||(window.$loadEventBus=new M);var L=function(o){return new Promise(function(h,m){if(window.$loadEventBus.on(o,h),window.$loadEventBus.listeners[o].requested===!1){window.$loadEventBus.listeners[o].requested=!0;var a=document.createElement("script");a.src=o,a.onload=function(){window.$loadEventBus.emit(o)},a.onerror=m,document.getElementsByTagName("head")[0].appendChild(a)}})},U=function(o){return new Promise(function(h,m){if(window.$loadEventBus.on(o,h),window.$loadEventBus.listeners[o].requested===!1){window.$loadEventBus.listeners[o].requested=!0;var a=document.createElement("link");a.type="text/css",a.rel="stylesheet",a.href=o,a.onload=function(){window.$loadEventBus.emit(o)},a.onerror=m,document.getElementsByTagName("head")[0].appendChild(a)}})},A=function(){return new Promise(function(o,h){if(e.editorDependencies&&e.editorDependenciesChecker&&e.editorDependenciesChecker()){o();return}if(!e.editorDependencies&&C()){o();return}var m=(e.editorDependencies||y).reduce(function(f,v){var _=/^((https?:)?\/\/)?[-a-zA-Z0-9]+(\.[-a-zA-Z0-9]+)+\//.test(v);if(!_){var b;v=(((b=e.config)==null?void 0:b.UEDITOR_HOME_URL)||"")+v}return v.slice(-3)===".js"?f.jsLinks.push(v):v.slice(-4)===".css"&&f.cssLinks.push(v),f},{jsLinks:[],cssLinks:[]}),a=m.jsLinks,R=m.cssLinks;Promise.all([Promise.all(R.map(function(f){return U(f)})),x(a.map(function(f){return function(){return L(f)}}))]).then(function(){return o()}).catch(h)})},w=function(){c=i.getContent(),r("update:modelValue",c)},B=function(){i.addListener("contentChange",w)},I=function(){i.document.getElementById("baidu_pastebin")||(c=i.getContent(),r("update:modelValue",c))},O=function(){s=new MutationObserver(q(I,e.observerDebounceTime)),s.observe(i.body,e.observerOptions)},g=function(){var o=e.editorId||"editor_"+H(8);E.value.id=o,r("before-init",o),i=window.UE.getEditor(o,e.config),i.addListener("ready",function(){l===d.READY?i.setContent(e.modelValue):(l=d.READY,r("ready",i),e.modelValue&&i.setContent(e.modelValue)),e.mode==="observer"&&window.MutationObserver?O():B()})};return N(p,function(u){l===d.UN_READY?(l=d.PENDING,(e.forceInit||typeof window<"u")&&A().then(function(){E.value?g():P(function(){return g()})}).catch(function(){throw new Error("[vue-ueditor-wrap] UEditor 资源加载失败！请检查资源是否存在，UEDITOR_HOME_URL 是否配置正确！")})):l===d.READY&&(u===c||i.setContent(u||""))},{immediate:!0}),S(function(){i&&i.removeListener("contentChange",w),s&&s.disconnect()}),F(function(){s&&s.disconnect&&s.disconnect(),e.destroy&&i&&i.destroy&&i.destroy()}),function(){return D("div",null,[D("div",{ref:E,name:e.name},null)])}}});var z=$(G),W="3.0.8";function Z(t){var e=[z];e.forEach(function(n){n.install?t.use(n):n.name&&t.component(n.name,n)})}const K={install:Z,version:W};export{z as VueUeditorWrap,K as default,Z as install,W as version};
