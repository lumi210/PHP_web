import{h as I,al as L,s as R,a as P,q as r,W as g,o as p,N as u,O as l,Z as W,k as $,U as v,m as a,l as E,x as c,p as n,aI as y,V as w,T as S,a5 as j}from"./vue-Cm_-Ome7.js";import{d as q,f as K,m as O,a as Z,b as A}from"./modulesdev-C1PYeWMv.js";import{v as m,_ as G}from"./index-BGkrm5xk.js";const H={class:"title"},J={class:"file-box h100"},Q={class:"sys-file file-window h100"},X={class:"tree-header"},Y={class:"sys-file-tip"},ee={class:"module-file file-window h100"},oe={class:"tree-header"},ae={class:"tree-header-btns"},te={class:"tree-header-btn"},le={class:"tree-header-btn"},ne={class:"custom-tree-node"},se=I({__name:"file",setup(ie){const i=L("baTable"),h=R(),t=P({backupDir:"",loading:{pack:!1,backup:!1},moduleFiles:[],moduleTreeUid:m()}),_=(o,e,s)=>{A({uid:i.form.extend.uid,type:s,path:o.data.path?o.data.path:""}).then(d=>{s=="root"&&!o.data.path&&(t.backupDir=d.data.backupDir,t.moduleFiles=d.data.moduleFiles,d.data.needBackup&&k()),e(d.data.data)})},x=(o,e)=>_(o,e,"root"),C=(o,e)=>_(o,e,"module"),F=o=>{q({path:o.path}).then(()=>{t.moduleTreeUid=m()})},z=(o,e)=>{const{checkedKeys:s}=e;K({uid:i.form.extend.uid,dir:o.dir?0:1,path:o.path,checked:s.includes(o.path)?1:0}).then(()=>{t.moduleTreeUid=m()})},k=()=>{t.loading.backup=!0,O({uid:i.form.extend.uid}).finally(()=>{t.loading.backup=!1})},D=()=>{t.loading.pack=!0,Z({uid:i.form.extend.uid}).then(o=>{window.location.href=o.data.url}).finally(()=>{t.loading.pack=!1})};return(o,e)=>{const s=r("Icon"),d=r("el-popover"),b=r("el-scrollbar"),T=r("el-popconfirm"),N=r("el-button"),B=r("el-dialog"),M=g("drag"),U=g("zoom");return p(),u(B,{class:"ba-operate-dialog","close-on-click-modal":!1,"model-value":c(i).form.extend.showFile,onClose:e[2]||(e[2]=f=>c(i).form.extend.showFile=!1),width:"50%","destroy-on-close":!0},{header:l(()=>[W((p(),$("div",H,e[3]||(e[3]=[v("模块文件管理")]))),[[M,[".ba-operate-dialog",".el-dialog__header"]],[U,".ba-operate-dialog"]])]),footer:l(()=>[a("div",{style:E("width: calc(100% - "+c(i).form.labelWidth/1.8+"px)")},[n(N,{disabled:t.loading.pack||t.loading.backup,onClick:e[1]||(e[1]=f=>c(i).form.extend.showFile=!1)},{default:l(()=>e[6]||(e[6]=[v("关闭")])),_:1},8,["disabled"])],4)]),default:l(()=>[a("div",J,[a("div",Q,[n(b,{class:"ba-table-form-scrollbar"},{default:l(()=>[a("div",X,[n(d,{placement:"right",width:200,trigger:"hover",content:"勾选目录以复制到模块，系统文件目录【展开】后才能自动选中模块已有文件！"},{reference:l(()=>[a("div",Y,[e[4]||(e[4]=a("span",null,"系统文件",-1)),n(s,{name:"el-icon-Warning",size:"14"})])]),_:1})]),n(c(y),{ref_key:"treeRef",ref:h,"default-checked-keys":t.moduleFiles,props:{isLeaf:"dir"},load:x,lazy:"","show-checkbox":"","node-key":"path","highlight-current":"",onCheck:z},null,8,["default-checked-keys"])]),_:1})]),a("div",ee,[n(b,{class:"ba-table-form-scrollbar"},{default:l(()=>[a("div",oe,[e[5]||(e[5]=a("span",null,"模块文件",-1)),a("div",ae,[n(d,{placement:"left",width:200,trigger:"hover",content:"文件的变更立即生效，建议时常备份，备份目录："+t.backupDir+" 初次打开此窗口会自动备份一次"},{reference:l(()=>[a("div",te,[t.loading.backup?(p(),u(s,{key:0,size:"13",color:"var(--el-color-primary)",name:"el-icon-Loading",class:"loading-icon"})):w("",!0),a("span",{onClick:k},"备份")])]),_:1},8,["content"]),n(d,{placement:"left",width:200,trigger:"hover",content:"点击下载模块包，请注意弹窗是否被拦截"},{reference:l(()=>[a("div",le,[t.loading.pack?(p(),u(s,{key:0,size:"13",color:"var(--el-color-primary)",name:"el-icon-Loading",class:"loading-icon"})):w("",!0),a("span",{onClick:D},"打模块包")])]),_:1})])]),(p(),u(c(y),{key:t.moduleTreeUid,ref_key:"treeRef",ref:h,props:{isLeaf:"dir"},load:C,lazy:"","node-key":"path","highlight-current":""},{default:l(({node:f,data:V})=>[a("span",ne,[a("span",null,S(f.label),1),n(T,{title:"确认删除？",onConfirm:de=>F(V)},{reference:l(()=>[n(s,{name:"el-icon-DeleteFilled",onClick:e[0]||(e[0]=j(()=>{},["stop"])),size:"13"})]),_:2},1032,["onConfirm"])])]),_:1}))]),_:1})])])]),_:1},8,["model-value"])}}}),ue=G(se,[["__scopeId","data-v-4d31d836"]]);export{ue as default};
