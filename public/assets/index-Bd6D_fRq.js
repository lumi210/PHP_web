import{w as M,am as O,a7 as P,a5 as _}from"./index-BGkrm5xk.js";import{_ as j}from"./popupForm.vue_vue_type_script_setup_true_lang-G4H6UFaT.js";import{b as z,R as K,T as Q,a as W}from"./index-D7pEq_sT.js";import{_ as Y}from"./index.vue_vue_type_style_index_0_lang-KySb_zIR.js";import{u as w}from"./lang-Ch7gu2FI.js";import{h as Z,s as S,a as G,j as J,at as k,B as X,q as i,W as ee,o as m,k as te,x as n,N as p,V as y,p as s,O as d,Z as ae,m as oe,T as ne}from"./vue-Cm_-Ome7.js";import"./index-Gg8Utg5G.js";import"./validate-CLs7Ey-q.js";import"./Extfield-CKk9p3fq.js";import"./index-6wQyfZWi.js";const se={class:"default-main ba-table-box"},le={class:"table-header-operate-text"},we=Z({name:"cms/content",__name:"index",setup(re){const{t:a}=M.useI18n(),u=S(),f=S(),v=[{render:"tipButton",name:"custom-edit",title:"编辑",text:"",type:"primary",icon:"fa fa-pencil",class:"ba-table-render-buttons-item",disabledTip:!1,display:(o,t)=>_({name:"/admin/cms/content",subNodeName:"/admin/cms/content/edit"}),click:(o,t)=>{e.onTableAction("edit",{row:o})}}],b=O().split("/"),r=b[b.length-1],g=G({select:!0,order:"sorting,asc",istop:0,search:[{field:"mcode",operator:"=",val:r},{field:"acode",operator:"=",val:w().getDataLang()}]}),c=new Date,C=c.getFullYear(),D=String(c.getMonth()+1).padStart(2,"0"),x=String(c.getDate()).padStart(2,"0"),T=String(c.getHours()).padStart(2,"0"),V=String(c.getMinutes()).padStart(2,"0"),$=String(c.getSeconds()).padStart(2,"0"),q=`${C}-${D}-${x} ${T}:${V}:${$}`,e=new z(new P("/admin/cms.Content/"),{pk:"id",column:[{type:"selection",align:"center",operator:!1},{label:a("cms.content.id"),prop:"id",align:"center",width:80,operator:!1,sortable:"custom"},{label:a("cms.content.scode"),prop:"scode",show:!1,align:"left",width:180,comSearchRender:"slot",comSearchSlotName:"scode",enableColumnDisplayControl:!1},{label:a("cms.content.scode"),prop:"contentsort.name",width:180,align:"left",operator:!1,sortable:!1},{label:a("cms.content.title"),prop:"title",align:"left",operatorPlaceholder:a("Fuzzy query"),operator:"LIKE",sortable:!1},{label:a("cms.content.date"),prop:"date",align:"left",sortable:"custom",width:200,operator:!1},{label:a("cms.content.status"),width:100,prop:"status",align:"center",render:"switch",operator:"eq",sortable:!1,replaceValue:{}},{label:a("cms.content.visits"),width:100,prop:"visits",align:"center",operator:!1,sortable:!1},{label:a("Operate"),align:"center",width:150,render:"buttons",buttons:v,operator:!1}],dblClickNotEditColumn:[void 0],filter:{mcode:r},showComSearch:!0},{defaultItems:{sorting:255,status:"1",visits:0,likes:0,oppose:0,gtype:"4",mcode:r,date:q}}),E=J(()=>e.table.selection.length>0);e.requestEdit=o=>{if(e.runBefore("requestEdit",{id:o})!==!1)return e.form.loading=!0,e.form.items={},e.api.edit({[e.table.pk]:o,mcode:r}).then(t=>{e.form.items=t.data.row,e.form.items.mcode=r,e.runAfter("requestEdit",{res:t})}).catch(t=>{e.toggleForm(),e.runAfter("requestEdit",{err:t})}).finally(()=>{e.form.loading=!1})},k("baTable",e),k("mcode",r),X(()=>{var o;e.table.ref=u.value,e.mount(),(o=e.getIndex())==null||o.then(()=>{e.initSort(),e.dragSort()})});const N=(o,t)=>{t.loading=!0,e.api.postData("edit",{[e.table.pk]:t[e.table.pk],sorting:o}).then(()=>{e.onTableAction("field-change",{value:o,...t}),e.table.data=[],e.getIndex()}).finally(()=>{t.loading=!1})},B=()=>{g.search[1].val=w().getDataLang(),f.value.getData()};return(o,t)=>{const I=i("el-alert"),R=i("Icon"),A=i("el-button"),L=i("el-tooltip"),U=i("el-input"),F=i("el-table-column"),H=ee("blur");return m(),te("div",se,[n(e).table.remark?(m(),p(I,{key:0,class:"ba-table-alert",title:n(e).table.remark,type:"info","show-icon":""},null,8,["title"])):y("",!0),s(Q,{buttons:["refresh","comSearch","quickSearch","columnDisplay"],"quick-search-placeholder":n(a)("Quick search placeholder",{fields:n(a)("cms.content.title")})},{refreshAppend:d(()=>[s(Y,{onChangeDataLang:B}),n(_)({name:"/admin/cms/content",subNodeName:"/admin/cms/content/edit"})?(m(),p(L,{key:0,content:n(a)("Edit selected row"),placement:"top"},{default:d(()=>[ae((m(),p(A,{onClick:t[0]||(t[0]=l=>n(e).onTableHeaderAction("edit",{})),disabled:!E.value,class:"table-header-operate",type:"primary"},{default:d(()=>[s(R,{name:"fa fa-pencil"}),oe("span",le,ne(n(a)("Edit")),1)]),_:1},8,["disabled"])),[[H]])]),_:1},8,["content"])):y("",!0)]),scode:d(()=>[s(K,{modelValue:n(e).comSearch.form.scode,"onUpdate:modelValue":t[1]||(t[1]=l=>n(e).comSearch.form.scode=l),pk:"content_sort.scode",field:"name",remoteUrl:"/admin/cms.ContentSort/index",params:g,ref_key:"scodeRef",ref:f,class:"el-select"},null,8,["modelValue","params"])]),_:1},8,["quick-search-placeholder"]),s(W,{ref_key:"tableRef",ref:u},{sorting:d(()=>[s(F,{label:n(a)("cms.content.sorting"),width:"100",align:"left"},{default:d(l=>[s(U,{modelValue:l.row.sorting,"onUpdate:modelValue":h=>l.row.sorting=h,onChange:h=>N(l.row.sorting,l.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1},8,["label"])]),_:1},512),s(j)])}}});export{we as default};
